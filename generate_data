import psycopg2
from psycopg2.extras import Json
from faker import Faker
import random

fake = Faker()

# PostgreSQL connection
conn = psycopg2.connect(
    host="localhost",
    database="job_stability",
    user="postgres",
    password="Sp@495520"
)
cur = conn.cursor()

# 1Ô∏è‚É£ Pehle purana data clear kar do
cur.execute("TRUNCATE TABLE candidates RESTART IDENTITY CASCADE;")
conn.commit()
print("Old data cleared.")

# 2Ô∏è‚É£ Columns ko FLOAT me convert karo
cur.execute("""
ALTER TABLE candidates 
ALTER COLUMN job_stability_score TYPE FLOAT USING job_stability_score::FLOAT,
ALTER COLUMN retention_risk_score TYPE FLOAT USING retention_risk_score::FLOAT,
ALTER COLUMN long_term_association_score TYPE FLOAT USING long_term_association_score::FLOAT,
ALTER COLUMN monetary_motivation_score TYPE FLOAT USING monetary_motivation_score::FLOAT,
ALTER COLUMN cultural_fit_score TYPE FLOAT USING cultural_fit_score::FLOAT;
""")
conn.commit()
print("Columns converted to FLOAT.")

def random_json_field():
    return Json({
        "dummy": fake.sentence(),
        "number": random.randint(1, 100)
    })

# 3Ô∏è‚É£ Naya dummy data insert karo
for i in range(100000):
    name = fake.name()
    email = fake.email()
    phone = fake.phone_number()
    linkedin = f"https://linkedin.com/in/{fake.user_name()}"
    skypeId = fake.user_name()
    gender = random.choice(["Male", "Female", "Other"])
    aadharCardNumber = fake.ssn()[:12]  # just dummy
    panCardNumber = ''.join(random.choices('ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789', k=10))
    skills = random_json_field()
    experience = random_json_field()
    education = random_json_field()
    projects = random_json_field()
    certifications = random_json_field()
    raw_text = fake.text(max_nb_chars=200)
    form_data = random_json_field()
    
    # üéØ Random FLOAT scores (0‚Äì100 range)
    job_stability_score = round(random.uniform(0, 100), 2)
    retention_risk_score = round(random.uniform(0, 100), 2)
    long_term_association_score = round(random.uniform(0, 100), 2)
    monetary_motivation_score = round(random.uniform(0, 100), 2)
    cultural_fit_score = round(random.uniform(0, 100), 2)

    cur.execute("""
        INSERT INTO candidates (
            name,email,phone,linkedin,skypeId,gender,aadharCardNumber,panCardNumber,
            skills,experience,education,projects,certifications,raw_text,form_data,
            job_stability_score,retention_risk_score,long_term_association_score,
            monetary_motivation_score,cultural_fit_score
        ) VALUES (%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s)
    """, (
        name,email,phone,linkedin,skypeId,gender,aadharCardNumber,panCardNumber,
        skills,experience,education,projects,certifications,raw_text,form_data,
        job_stability_score,retention_risk_score,long_term_association_score,
        monetary_motivation_score,cultural_fit_score
    ))

    if (i+1) % 1000 == 0:
        conn.commit()
        print(f"{i+1} rows inserted...")

conn.commit()
cur.close()
conn.close()
print("‚úÖ Done! 100,000 dummy candidates inserted with FLOAT scores.")
